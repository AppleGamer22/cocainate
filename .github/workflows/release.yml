name: Release to GitHub
on:
  release:
    types: [published]
jobs:
  github_release:
    runs-on: ubuntu-latest
    steps:
      - name: Pull Source Code
        uses: actions/checkout@v2.3.4
      - name: Set-up Go
        uses: actions/setup-go@v2.1.3
        with:
          go-version: "1.17.5"
      - name: Build & Package
        run: make package
      - name: Get version
        id: get_version
        run: |
          version=GITHUB_REF##*/
          echo ::set-output name=VERSION::${version:1}
      - name: Upload linux/amd64 Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{github.event.release.upload_url}}
          asset_name: cocainate_${{steps.get_version.outputs.VERSION}}_linux_amd64.tar.gz
          asset_path: ./bin/cocainate_${{steps.get_version.outputs.VERSION}}_linux_amd64.tar.gz
          asset_content_type: application/gzip
      - name: Upload linux/arm64 Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{github.event.release.upload_url}}
          asset_name: cocainate_${{steps.get_version.outputs.VERSION}}_linux_arm64.tar.gz
          asset_path: ./bin/cocainate_${{steps.get_version.outputs.VERSION}}_linux_arm64.tar.gz
          asset_content_type: application/gzip
      - name: Upload linux/riscv64 Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{github.event.release.upload_url}}
          asset_name: cocainate_${{steps.get_version.outputs.VERSION}}_linux_riscv64.tar.gz
          asset_path: ./bin/cocainate_${{steps.get_version.outputs.VERSION}}_linux_riscv64.tar.gz
          asset_content_type: application/gzip
      - name: Upload mac/amd64 Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{github.event.release.upload_url}}
          asset_name: cocainate_${{steps.get_version.outputs.VERSION}}_mac_amd64.tar.gz
          asset_path: ./bin/cocainate_${{steps.get_version.outputs.VERSION}}_mac_amd64.tar.gz
          asset_content_type: application/gzip
      - name: Upload mac/arm64 Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{github.event.release.upload_url}}
          asset_name: cocainate_${{steps.get_version.outputs.VERSION}}_mac_arm64.tar.gz
          asset_path: ./bin/cocainate_${{steps.get_version.outputs.VERSION}}_mac_arm64.tar.gz
          asset_content_type: application/gzip
      - name: Upload windows/amd64 Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{github.event.release.upload_url}}
          asset_name: cocainate_${{steps.get_version.outputs.VERSION}}_windows_amd64.zip
          asset_path: ./bin/cocainate_${{steps.get_version.outputs.VERSION}}_windows_amd64.exe.zip
          asset_content_type: application/zip
      - name: Upload windows/arm64 Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{github.event.release.upload_url}}
          asset_name: cocainate_${{steps.get_version.outputs.VERSION}}_windows_arm64.zip
          asset_path: ./bin/cocainate_${{steps.get_version.outputs.VERSION}}_windows_arm64.exe.zip
          asset_content_type: application/zip